<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Track your food, reduce waste, and save money with Smart Food Saver dashboard">
  <title>Dashboard - Smart Food Saver</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="dashboard.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    /* Ensure modal is hidden by default */
    .modal[hidden] {
      display: none !important;
    }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <nav class="navbar" role="navigation" aria-label="Main navigation">
    <a href="index.html" class="navbar-brand" aria-label="Smart Food Saver Home">
      <img src="https://cdn-icons-png.flaticon.com/512/1046/1046784.png" alt="" width="32" height="32">
      <span>Smart Food Saver</span>
    </a>
    <div class="navbar-menu">
      <a href="index.html">Home</a>
      <a href="dashboard.html" class="active" aria-current="page">Dashboard</a>
      <a href="recipes.html">Recipes</a>
      <a href="donations.html">Donations</a>
      <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode">
        <i class="fa fa-moon" aria-hidden="true"></i>
      </button>
    </div>
  </nav>

  <main id="main-content">
    <div class="container">
      <header class="dashboard-header">
        <div>
          <h1>Dashboard</h1>
          <p class="muted">Track your food, reduce waste, and save money.</p>
        </div>
        <div class="quick-stats">
          <div class="quick-stat">
            <i class="fa fa-calendar" aria-hidden="true"></i>
            <span id="dateToday"></span>
          </div>
        </div>
      </header>

      <!-- Notification Prompt (if not enabled) -->
      <div id="notificationPrompt" class="notification-prompt" style="display: none;">
        <div class="notification-prompt-text">
          <strong>üîî Enable Notifications</strong>
          <p>Get alerts when your food is about to expire!</p>
        </div>
        <button onclick="enableNotifications()" class="btn">
          <i class="fa fa-bell"></i> Enable Alerts
        </button>
      </div>

      <div class="dashboard-container">
        <!-- Add Food Log Card -->
        <div class="card">
          <h2><i class="fa fa-plus-circle" aria-hidden="true"></i> Add Food Log</h2>
          <form id="foodForm" aria-label="Add food log form">
            <div class="form-group">
              <label for="foodName">Food Name *</label>
              <input 
                id="foodName" 
                type="text"
                placeholder="e.g., Apples, Bread, Rice" 
                required 
                aria-required="true"
                autocomplete="off">
              <span class="error-message" id="foodNameError"></span>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="quantity">Quantity</label>
                <input 
                  id="quantity" 
                  type="text"
                  placeholder="e.g., 2 kg, 5 pieces"
                  autocomplete="off">
              </div>

              <div class="form-group">
                <label for="estimatedCost">Cost (‚Çπ)</label>
                <input 
                  id="estimatedCost" 
                  type="number" 
                  step="0.01" 
                  min="0"
                  placeholder="0.00"
                  aria-label="Estimated cost in rupees">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="expiryDate">Expiry Date</label>
                <input 
                  id="expiryDate" 
                  type="date"
                  aria-label="Expiry date">
              </div>

              <div class="form-group">
                <label for="status">Status *</label>
                <select id="status" required aria-required="true">
                  <option value="saved">‚úÖ Saved</option>
                  <option value="wasted">‚ùå Wasted</option>
                  <option value="donated">ü§ù Donated</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="reason">Reason (if wasted)</label>
              <input 
                id="reason" 
                type="text"
                placeholder="e.g., Expired, Spoiled, Overcooked">
            </div>

            <button type="submit" class="btn btn-submit">
              <i class="fa fa-plus" aria-hidden="true"></i> Add Entry
            </button>
          </form>
        </div>

        <!-- History Card -->
        <div class="card">
          <div class="card-header">
            <h2><i class="fa fa-history" aria-hidden="true"></i> History</h2>
            <div class="card-actions">
              <input 
                type="search" 
                id="searchInput" 
                placeholder="Search food..."
                aria-label="Search food history">
              <select id="filterStatus" aria-label="Filter by status">
                <option value="all">All Status</option>
                <option value="saved">Saved</option>
                <option value="wasted">Wasted</option>
                <option value="donated">Donated</option>
              </select>
            </div>
          </div>

          <div class="tabs" role="tablist">
            <button 
              class="tab active" 
              data-target="foodHistory"
              role="tab"
              aria-selected="true"
              aria-controls="foodHistory">
              All Entries
            </button>
            <button 
              class="tab" 
              data-target="expiryAlerts"
              role="tab"
              aria-selected="false"
              aria-controls="expiryAlerts">
              <i class="fa fa-bell" aria-hidden="true"></i> Expiring Soon
            </button>
          </div>

          <div id="foodHistory" class="tab-content active" role="tabpanel"></div>
          <div id="expiryAlerts" class="tab-content" role="tabpanel" hidden></div>
        </div>

        <!-- Impact Card -->
        <div class="card">
          <h2><i class="fa fa-chart-line" aria-hidden="true"></i> Your Impact</h2>
          
          <div class="stats">
            <div class="stat-item wasted">
              <i class="fa fa-trash" aria-hidden="true"></i>
              <div>
                <strong id="totalWasted">0</strong>
                <span>Wasted</span>
              </div>
            </div>
            <div class="stat-item saved">
              <i class="fa fa-check-circle" aria-hidden="true"></i>
              <div>
                <strong id="totalSaved">0</strong>
                <span>Saved</span>
              </div>
            </div>
            <div class="stat-item donated">
              <i class="fa fa-hand-holding-heart" aria-hidden="true"></i>
              <div>
                <strong id="totalDonated">0</strong>
                <span>Donated</span>
              </div>
            </div>
            <div class="stat-item money">
              <i class="fa fa-rupee-sign" aria-hidden="true"></i>
              <div>
                <strong id="moneySaved">‚Çπ0</strong>
                <span>Money Saved</span>
              </div>
            </div>
            <div class="stat-item co2">
              <i class="fa fa-leaf" aria-hidden="true"></i>
              <div>
                <strong id="co2Saved">0kg</strong>
                <span>CO‚ÇÇ Saved</span>
              </div>
            </div>
          </div>

          <div class="level">
            <div class="level-header">
              <div>
                <h3>Level <span id="userLevel">1</span>: <span id="levelName">Waste Warrior</span> <span id="levelEmoji">üèÜ</span></h3>
                <p class="muted"><span id="levelPoints">0</span> / <span id="nextLevelPoints">100</span> pts</p>
              </div>
            </div>
            <div class="progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
              <div id="levelBar" class="progress-bar"></div>
            </div>
          </div>

          <div class="chart-container">
            <canvas id="impactChart" aria-label="Impact over time chart" role="img"></canvas>
          </div>
        </div>
      </div>

      <div class="actions">
        <button id="downloadJSON" class="btn btn-outline" aria-label="Download data as JSON">
          <i class="fa fa-download" aria-hidden="true"></i> Export JSON
        </button>
        <button id="downloadCSV" class="btn btn-outline" aria-label="Download data as CSV">
          <i class="fa fa-file-csv" aria-hidden="true"></i> Export CSV
        </button>
        <button id="clearAll" class="btn btn-danger" aria-label="Clear all data">
          <i class="fa fa-trash" aria-hidden="true"></i> Clear All
        </button>
      </div>
    </div>
  </main>

  <!-- Toast Notification -->
  <div id="toast" class="toast" role="alert" aria-live="polite" hidden style="display: none;"></div>

  <!-- Confirmation Modal - HIDDEN BY DEFAULT -->
  <div id="confirmModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" hidden style="display: none;">
    <div class="modal-content">
      <h2 id="modalTitle">Confirm Action</h2>
      <p id="modalMessage">Are you sure you want to proceed?</p>
      <div class="modal-actions">
        <button id="modalCancel" class="btn btn-outline">Cancel</button>
        <button id="modalConfirm" class="btn btn-danger">Confirm</button>
      </div>
    </div>
  </div>

  <footer class="footer reveal" role="contentinfo">
    <div class="footer-content">
      <p>&copy; 2025 Smart Food Saver. All rights reserved.</p>
      <nav class="footer-nav" aria-label="Footer navigation">
        <a href="index.html">Home</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="recipes.html">Recipes</a>
        <a href="donations.html">Donations</a>
      </nav>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="script.js"></script>
  <script src="dashboard.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="auth-check.js"></script>
  <script src="script.js"></script>
  <script src="dashboard.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="auth-check.js"></script>
  <script src="notification.js"></script>
  <script src="script.js"></script>
  <script src="dashboard.js"></script>
  <script>
    // Initialize notifications when page loads
    document.addEventListener('DOMContentLoaded', () => {
      // Show notification prompt if not granted
      if (Notification.permission === 'default') {
        document.getElementById('notificationPrompt').style.display = 'flex';
      }
      
      // Initialize notification system
      initNotifications();
    });
  </script>
</body>
</html>